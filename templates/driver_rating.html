<!DOCTYPE html>
<html>
  <head>
    <title>{{ driver }} - Profile</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        background-color: #f8f9fa;
      }

      .profile-box {
        background-color: #fff;
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        padding: 2rem;
        margin-bottom: 2rem;
      }

      .driver-img {
        width: 180px;
        height: 180px;
        border-radius: 50%;
        object-fit: cover;
        border: 4px solid #dee2e6;
      }

      .stat-table th,
      .stat-table td {
        text-align: center;
        vertical-align: middle;
      }

      .section-header {
        font-weight: 600;
        margin-bottom: 0.75rem;
      }

      .value-change {
        font-weight: 600;
      }

      .badge-custom {
        background-color: #ffc107;
        color: #212529;
        font-size: 0.8rem;
        margin-left: 0.5rem;
      }

      .management-buttons button {
        width: 100%;
      }
    </style>
  </head>
  <body class="container py-5">
    <!-- Header -->
    <div class="row align-items-center profile-box">
      <div class="col-md-3 text-center">
        <img
          src="{{ driver_img_url }}"
          alt="{{ driver }} Image"
          class="driver-img"
          onerror="this.onerror=null; this.src='https://via.placeholder.com/180';"
        />
      </div>
      <div class="col-md-6 text-center text-md-start">
        <h2 class="fw-bold">{{ driver }}</h2>
        <p class="fs-5">
          ğŸ’°
          <strong style="color: {{ value_color }}">{{ fantasy_value }}</strong>
          <span class="fs-6">{{ percent_display }}</span>
        </p>
        {% if previous_value %}
        <p class="text-muted">Previous Value: {{ previous_value }}</p>
        {% endif %} {% if user_roster %}
        <p class="mb-1">
          ğŸ“¦ Bought at: ${{ user_roster.value_at_buy | round | int | format(',')
          }}
        </p>
        <p
          class="value-change {{ 'text-success' if user_roster.current_value > user_roster.value_at_buy else 'text-danger' }}"
        >
          ğŸ“ˆ Value Gained: ${{ (user_roster.current_value -
          user_roster.value_at_buy) | round | int | format(',') }}
        </p>
        <p class="mb-0">
          ğŸ Races Owned: {{ user_roster.races_owned }} | ğŸš€ Boost Points: {{
          user_roster.boost_points }}
        </p>
        {% endif %}
      </div>

      <!-- Buttons -->
      <div class="col-md-3 management-buttons mt-4 mt-md-0">
        {% if current_user.is_authenticated %} {% if weekday < 4 %}
        <form method="POST" action="/add_driver/{{ driver }}">
          <button class="btn btn-success mb-2">â• Purchase</button>
        </form>
        <form method="POST" action="/remove_driver/{{ driver }}">
          <button class="btn btn-danger mb-2">â– Sell</button>
        </form>
        {% else %}
        <div class="alert alert-warning py-2 text-center">
          ğŸ”’ Driver changes locked (Friâ€“Sun)
        </div>
        {% endif %} {% else %}
        <p class="text-center">
          <a href="/login">Log in</a> to manage your team
        </p>
        {% endif %}
        <a
          href="{{ url_for('driver_season_view', driver=driver) }}"
          class="btn btn-secondary mb-2"
          >ğŸ“† View Season</a
        >
        <a href="/" class="btn btn-outline-dark">â¬… Back</a>
      </div>
    </div>

    <!-- Stats Section -->
    <div class="profile-box">
      <h4 class="section-header">ğŸ“Š Driver Performance Summary</h4>
      <div class="row g-4">
        <div class="col-md-6 col-lg-3">
          <div class="border rounded p-3">
            <h6 class="text-center mb-3">ğŸ“ˆ Last 3 Races</h6>
            <table class="table table-bordered stat-table">
              <tr>
                <th>Quali</th>
                <th>Race</th>
                <th>+Pos</th>
                <th>Pts</th>
              </tr>
              <tr>
                <td>{{ last_3.Quali }}</td>
                <td>{{ last_3.Race }}</td>
                <td>{{ last_3["+Pos"] }}</td>
                <td>{{ last_3["Total Points"] }}</td>
              </tr>
            </table>
          </div>
        </div>

        <div class="col-md-6 col-lg-3">
          <div class="border rounded p-3">
            <h6 class="text-center mb-3">ğŸ“‰ Prev 3 Races</h6>
            <table class="table table-bordered stat-table">
              <tr>
                <th>Quali</th>
                <th>Race</th>
                <th>+Pos</th>
                <th>Pts</th>
              </tr>
              <tr>
                <td>{{ prev_3.Quali }}</td>
                <td>{{ prev_3.Race }}</td>
                <td>{{ prev_3["+Pos"] }}</td>
                <td>{{ prev_3["Total Points"] }}</td>
              </tr>
            </table>
          </div>
        </div>

        <div class="col-md-6 col-lg-3">
          <div class="border rounded p-3">
            <h6 class="text-center mb-3">ğŸ“Š Seasonal Avg</h6>
            <table class="table table-bordered stat-table">
              <tr>
                <th>Quali</th>
                <th>Race</th>
                <th>+Pos</th>
                <th>Pts</th>
              </tr>
              <tr>
                <td>{{ season_avg.Quali }}</td>
                <td>{{ season_avg.Race }}</td>
                <td>{{ season_avg["+Pos"] }}</td>
                <td>{{ season_avg["Total Points"] }}</td>
              </tr>
            </table>
          </div>
        </div>

        <div class="col-md-6 col-lg-3">
          <div class="border rounded p-3">
            <h6 class="text-center mb-3">ğŸ“ Last Race</h6>
            <table class="table table-bordered stat-table">
              <tr>
                <th>Quali</th>
                <th>Race</th>
                <th>+Pos</th>
                <th>Pts</th>
              </tr>
              <tr>
                <td>{{ last_race.Quali }}</td>
                <td>{{ last_race.Race }}</td>
                <td>{{ last_race["+Pos"] }}</td>
                <td>{{ last_race["Total Points"] }}</td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
